<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>align.schema.constraint &mdash; ALIGN</title><link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html"><img src="../../../_static/LOGO.PNG" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Get started:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/flow.html">ALIGN: flow</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../notes/flow.html#inputs">Inputs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notes/flow.html#outputs">Outputs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../notes/installation.html#step-0-check-prerequisites">Step 0: Check prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notes/installation.html#step-1-clone-the-align-source-code-to-your-local-environment">Step 1: Clone the ALIGN source code to your local environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notes/installation.html#step-2-create-a-python-virtualenv">Step 2: Create a Python virtualenv</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notes/installation.html#step-3a-install-align-as-a-user">Step 3a: Install ALIGN as a USER</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notes/installation.html#step-3b-install-align-as-a-developer">Step 3b: Install ALIGN as a DEVELOPER</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notes/installation.html#step-4-run-align">Step 4: Run ALIGN</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notes/installation.html#step-5-view-layout">Step 5: View layout</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/introduction.html">Introduction by Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/viewer.html">Layout viewer</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../notes/viewer.html#klayout-viewer">KLayout viewer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notes/viewer.html#align-viewer">ALIGN viewer</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/const.html">Constraints</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../notes/const.html#constraint-options">Constraint options</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../notes/const.html#symmetricblocks">SymmetricBlocks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../notes/const.html#order">Order</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../notes/const.html#align">Align</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../notes/const.html#enclose">Enclose</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../notes/const.html#spread">Spread</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../notes/const.html#aspectratio">AspectRatio</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../notes/const.html#boundary">Boundary</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../notes/const.html#aligninorder">AlignInOrder</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../notes/const.html#compactplacement">CompactPlacement</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../notes/const.html#sametemplate">SameTemplate</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../notes/const.html#createalias">CreateAlias</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../notes/const.html#groupblocks">GroupBlocks</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../notes/const.html#donotidentify">DoNotIdentify</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../notes/const.html#blockdistance">BlockDistance</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../notes/const.html#horizontaldistance">HorizontalDistance</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../notes/const.html#verticaldistance">VerticalDistance</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../notes/const.html#guardring">GuardRing</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../notes/const.html#groupcaps">GroupCaps</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../notes/const.html#netconst">NetConst</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../notes/const.html#portlocation">PortLocation</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../notes/const.html#symmetricnets">SymmetricNets</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../notes/const.html#multiconnection">MultiConnection</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../notes/const.html#powerports">PowerPorts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../notes/const.html#groundports">GroundPorts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../notes/const.html#clockports">ClockPorts</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../notes/const.html#donotuselib">DoNotUseLib</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../notes/const.html#configurecompiler">ConfigureCompiler</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../notes/const.html#example-constraints">Example constraints</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/adding_pdk.html">PDK abstraction</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../notes/adding_pdk.html#pdk-options">PDK options</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notes/adding_pdk.html#definition-of-beol-design-rules">Definition of BEOL Design rules</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notes/adding_pdk.html#definition-of-feol-design-rules">Definition of FEOL Design rules</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/adding_pdk.html#cell-generator">Cell generator</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../notes/adding_pdk.html#standalone-usage">Standalone usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notes/adding_pdk.html#cell-fabric">Cell fabric</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notes/adding_pdk.html#primitive">Primitive</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Datasets:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/database.html">Database</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../notes/database.html#sized-netlists">Sized netlists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notes/database.html#unsized-netlists">Unsized netlists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notes/database.html#generalized-testbenches">Generalized testbenches</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Notes:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/contribute.html">Contribute to ALIGN</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../notes/contribute.html#some-example-contributions">Some example contributions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notes/contribute.html#install-align-setup-as-a-developer">Install ALIGN setup as a developer</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/success_stories.html">ALIGN gallery</a></li>
</ul>
<p class="caption"><span class="caption-text">Package Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/align.html">align package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/align.cell_fabric.html">align.cell_fabric package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/align.compiler.html">align.compiler package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/align.gdsconv.html">align.gdsconv package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/align.gui.html">align.gui package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/align.pdk.html">align.pdk package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/align.pdk.finfet.html">align.pdk.finfet package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/align.pnr.html">align.pnr package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/align.primitive.html">align.primitive package</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../modules/align.primitive.default.html">align.primitive.default package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/align.schema.html">align.schema package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/align.utils.html">align.utils package</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/align.schema.html">align.schema package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/align.compiler.html">align.compiler package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/align.primitive.html">align.primitive package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/align.primitive.default.html">align.primitive.default package</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/align.pnr.html">align.pnr package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/align.pdk.html">align.pdk package</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../modules/align.pdk.finfet.html">align.pdk.finfet package</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/align.cell_fabric.html">align.cell_fabric package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/align.primitive.default.html">align.primitive.default package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/align.pdk.finfet.html">align.pdk.finfet package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/align.utils.html">align.utils package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/align.gdsconv.html">align.gdsconv package</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../modules/align.gui.html">align.gui package</a></li>
</ul>
<p class="caption"><span class="caption-text">MISC:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/debug.html">Installation debug</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../notes/debug.html#error-due-to-gcc-version">Error due to gcc version</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notes/debug.html#error-due-to-xvfb-library-used-to-generate-image-of-layout">Error due to xvfb library used to generate image of layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notes/debug.html#error-due-to-python-virtual-environment-prerequisite-missing">Error due to python virtual environment prerequisite missing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notes/debug.html#error-due-to-klayout-prerequisite-missing">Error due to klayout prerequisite missing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notes/debug.html#reinstalling-align">Reinstalling ALIGN</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notes/debug.html#error-due-to-g-package-not-updated">Error due to g++ package not updated</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../notes/debug.html#warnings-that-can-be-ignored">Warnings that can be ignored:</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../notes/FAQs.html">Frequently Asked Questions</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../../../notes/FAQs.html#how-to-add-specific-pdks">How to add specific PDKs?</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">ALIGN</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      <li>align.schema.constraint</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for align.schema.constraint</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">abc</span>
<span class="kn">import</span> <span class="nn">more_itertools</span> <span class="k">as</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">itertools</span> <span class="k">as</span> <span class="nn">plain_itertools</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">logging</span>


<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">types</span>
<span class="kn">from</span> <span class="nn">.types</span> <span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">Union</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">set_context</span>

<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">Field</span>


<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;(?&lt;!^)(?=[A-Z])&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="get_instances_from_hacked_dataclasses"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.get_instances_from_hacked_dataclasses">[docs]</a><span class="k">def</span> <span class="nf">get_instances_from_hacked_dataclasses</span><span class="p">(</span><span class="n">constraint</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">constraint</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Cannot access parent scope&#39;</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">constraint</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="s1">&#39;graph&#39;</span><span class="p">):</span>
        <span class="n">instances</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">constraint</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">graph</span><span class="o">.</span><span class="n">nodes</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">v</span><span class="p">[</span><span class="s1">&#39;inst_type&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;net&#39;</span><span class="p">}</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">constraint</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="s1">&#39;elements&#39;</span><span class="p">):</span>
        <span class="n">instances</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">constraint</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">elements</span><span class="p">}</span>
    <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">constraint</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="s1">&#39;instances&#39;</span><span class="p">):</span>
        <span class="n">instances</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="o">.</span><span class="n">instance_name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">constraint</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">instances</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot handle </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">constraint</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">constraint</span><span class="o">.</span><span class="n">parent</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="s1">&#39;name&#39;</span><span class="p">)}</span>
    <span class="k">return</span> <span class="nb">set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">instances</span><span class="p">,</span> <span class="n">names</span><span class="p">)</span></div>


<div class="viewcode-block" id="validate_instances"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.validate_instances">[docs]</a><span class="k">def</span> <span class="nf">validate_instances</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="c1"># instances = cls._validator_ctx().parent.parent.instances</span>
    <span class="n">instances</span> <span class="o">=</span> <span class="n">get_instances_from_hacked_dataclasses</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_validator_ctx</span><span class="p">())</span>
    <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">instances</span><span class="p">,</span> <span class="nb">set</span><span class="p">),</span> <span class="s1">&#39;Could not retrieve instances from subcircuit definition&#39;</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>  <span class="c1"># explicit loop to point out the not found instance</span>
        <span class="k">assert</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">instances</span> <span class="ow">or</span> <span class="n">x</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">in</span> <span class="n">instances</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Instance </span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s2"> not found in the circuit&quot;</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span></div>


<div class="viewcode-block" id="upper_case"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.upper_case">[docs]</a><span class="k">def</span> <span class="nf">upper_case</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span></div>


<div class="viewcode-block" id="assert_non_negative"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.assert_non_negative">[docs]</a><span class="k">def</span> <span class="nf">assert_non_negative</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">assert</span> <span class="n">value</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Value must be non-negative: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="k">return</span> <span class="n">value</span></div>


<div class="viewcode-block" id="SoftConstraint"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.SoftConstraint">[docs]</a><span class="k">class</span> <span class="nc">SoftConstraint</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">BaseModel</span><span class="p">):</span>

    <span class="n">constraint</span><span class="p">:</span> <span class="nb">str</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">constraint</span> <span class="o">=</span> <span class="n">pattern</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span>
            <span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">if</span> <span class="s1">&#39;constraint&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;constraint&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;constraint&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">constraint</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">constraint</span> <span class="o">==</span> <span class="n">kwargs</span><span class="p">[</span>
                <span class="s1">&#39;constraint&#39;</span><span class="p">],</span> <span class="sa">f</span><span class="s1">&#39;Unexpected `constraint` </span><span class="si">{</span><span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;constraint&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1"> (expected </span><span class="si">{</span><span class="n">constraint</span><span class="si">}</span><span class="s1">)&#39;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="HardConstraint"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.HardConstraint">[docs]</a><span class="k">class</span> <span class="nc">HardConstraint</span><span class="p">(</span><span class="n">SoftConstraint</span><span class="p">,</span> <span class="n">abc</span><span class="o">.</span><span class="n">ABC</span><span class="p">):</span>

<div class="viewcode-block" id="HardConstraint.translate"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.HardConstraint.translate">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solver</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Abstract Method for built in self-checks</span>
<span class="sd">          Every class that inherits from HardConstraint</span>
<span class="sd">          MUST implement this function.</span>

<span class="sd">        Function must yield a list of mathematical</span>
<span class="sd">          expressions supported by the &#39;solver&#39;</span>
<span class="sd">          backend. This can be done using multiple</span>
<span class="sd">          &#39;yield&#39; statements or returning an iterable</span>
<span class="sd">          object such as list</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">pass</span></div></div>


<div class="viewcode-block" id="UserConstraint"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.UserConstraint">[docs]</a><span class="k">class</span> <span class="nc">UserConstraint</span><span class="p">(</span><span class="n">HardConstraint</span><span class="p">,</span> <span class="n">abc</span><span class="o">.</span><span class="n">ABC</span><span class="p">):</span>

<div class="viewcode-block" id="UserConstraint.yield_constraints"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.UserConstraint.yield_constraints">[docs]</a>    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">yield_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Abstract Method to yield low level constraints</span>
<span class="sd">          Every class that inherits from UserConstraint</span>
<span class="sd">          MUST implement this function. This ensures</span>
<span class="sd">          clean separation of user-facing constraints</span>
<span class="sd">          from PnR constraints</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="UserConstraint.translate"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.UserConstraint.translate">[docs]</a>    <span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solver</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">constraint</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">yield_constraints</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">constraint</span><span class="p">,</span> <span class="n">HardConstraint</span><span class="p">):</span>
                <span class="k">yield from</span> <span class="n">constraint</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">solver</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Order"><a class="viewcode-back" href="../../../notes/const.html#align.schema.constraint.Order">[docs]</a><span class="k">class</span> <span class="nc">Order</span><span class="p">(</span><span class="n">HardConstraint</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Defines a placement order for instances in a subcircuit.</span>

<span class="sd">    Args:</span>
<span class="sd">        instances (list[str]): List of :obj:`instances`</span>
<span class="sd">        direction (str, optional): The following options for direction are supported</span>

<span class="sd">            :obj:`&#39;horizontal&#39;`, placement order is left to right or vice-versa.</span>

<span class="sd">            :obj:`&#39;vertical&#39;`,  placement order is bottom to top or vice-versa.</span>

<span class="sd">            :obj:`&#39;left_to_right&#39;`, placement order is left to right.</span>

<span class="sd">            :obj:`&#39;right_to_left&#39;`, placement order is right to left.</span>

<span class="sd">            :obj:`&#39;bottom_to_top&#39;`, placement order is bottom to top.</span>

<span class="sd">            :obj:`&#39;top_to_bottom&#39;`, placement order is top to bottom.</span>

<span class="sd">            :obj:`None`: default (:obj:`&#39;horizontal&#39;` or :obj:`&#39;vertical&#39;`)</span>
<span class="sd">        abut (bool, optional): If `abut` is `true` adjoining instances will touch</span>

<span class="sd">    .. image:: ../images/OrderBlocks.PNG</span>
<span class="sd">        :align: center</span>

<span class="sd">    WARNING: `Order` does not imply aligment / overlap</span>
<span class="sd">    of any sort (See `Align`)</span>

<span class="sd">    Example: ::</span>

<span class="sd">        {&quot;constraint&quot;:&quot;Order&quot;, &quot;instances&quot;: [&#39;MN0&#39;, &#39;MN1&#39;, &#39;MN2&#39;], &quot;direction&quot;: &quot;left_to_right&quot;}</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">instances</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">direction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span>
        <span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="s1">&#39;vertical&#39;</span><span class="p">,</span>
        <span class="s1">&#39;left_to_right&#39;</span><span class="p">,</span> <span class="s1">&#39;right_to_left&#39;</span><span class="p">,</span>
        <span class="s1">&#39;bottom_to_top&#39;</span><span class="p">,</span> <span class="s1">&#39;top_to_bottom&#39;</span>
    <span class="p">]]</span>
    <span class="n">abut</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

<div class="viewcode-block" id="Order.order_instances_validator"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.Order.order_instances_validator">[docs]</a>    <span class="nd">@types</span><span class="o">.</span><span class="n">validator</span><span class="p">(</span><span class="s1">&#39;instances&#39;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">order_instances_validator</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Must contain at least two instances&#39;</span>
        <span class="k">return</span> <span class="n">validate_instances</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Order.translate"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.Order.translate">[docs]</a>    <span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solver</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">cc</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">):</span>  <span class="c1"># Create coordinate constraint</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">abut</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;ur</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">b2</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;ll</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;ur</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">b2</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;ll</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">bvars</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">iter_bbox_vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">pairwise</span><span class="p">(</span><span class="n">bvars</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;left_to_right&#39;</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">cc</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;right_to_left&#39;</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">cc</span><span class="p">(</span><span class="n">b2</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;bottom_to_top&#39;</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">cc</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;top_to_bottom&#39;</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">cc</span><span class="p">(</span><span class="n">b2</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">solver</span><span class="o">.</span><span class="n">Or</span><span class="p">(</span>
                    <span class="n">cc</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">),</span>
                    <span class="n">cc</span><span class="p">(</span><span class="n">b2</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">))</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;vertical&#39;</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">solver</span><span class="o">.</span><span class="n">Or</span><span class="p">(</span>
                    <span class="n">cc</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">),</span>
                    <span class="n">cc</span><span class="p">(</span><span class="n">b2</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">solver</span><span class="o">.</span><span class="n">Or</span><span class="p">(</span>
                    <span class="n">cc</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">),</span>
                    <span class="n">cc</span><span class="p">(</span><span class="n">b2</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">),</span>
                    <span class="n">cc</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">),</span>
                    <span class="n">cc</span><span class="p">(</span><span class="n">b2</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">))</span></div></div>


<div class="viewcode-block" id="Align"><a class="viewcode-back" href="../../../notes/const.html#align.schema.constraint.Align">[docs]</a><span class="k">class</span> <span class="nc">Align</span><span class="p">(</span><span class="n">HardConstraint</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    `Instances` will be aligned along `line`. Could be</span>
<span class="sd">    strict or relaxed depending on value of `line`</span>

<span class="sd">    Args:</span>
<span class="sd">        instances (list[str]): List of `instances`</span>
<span class="sd">        line (str, optional): The following `line` values are currently supported:</span>

<span class="sd">            :obj:`h_any`, align instance&#39;s top, bottom or anything in between.</span>

<span class="sd">            :obj:`&#39;v_any&#39;`, align instance&#39;s left, right or anything in between.</span>

<span class="sd">            :obj:`&#39;h_top&#39;`, align instance&#39;s horizontally based on top.</span>

<span class="sd">            :obj:`&#39;h_bottom&#39;`, align instance&#39;s horizomtally based on bottom.</span>

<span class="sd">            :obj:`&#39;h_center&#39;`, align instance&#39;s horizontally based on center.</span>

<span class="sd">            :obj:`&#39;v_left&#39;`, align instance&#39;s vertically based on left.</span>

<span class="sd">            :obj:`&#39;v_right&#39;`, align instance&#39;s vertically based on right.</span>

<span class="sd">            :obj:`&#39;v_center&#39;`, align instance&#39;s vertically based on center.</span>

<span class="sd">            :obj:`None`:default (:obj:`&#39;h_any&#39;` or :obj:`&#39;v_any&#39;`).</span>

<span class="sd">    .. image:: ../images/AlignBlocks.PNG</span>
<span class="sd">        :align: center</span>

<span class="sd">    WARNING: `Align` does not imply ordering of any sort</span>
<span class="sd">    (See `Order`)</span>

<span class="sd">    Example: ::</span>

<span class="sd">        {&quot;constraint&quot;:&quot;Align&quot;, &quot;instances&quot;: [&#39;MN0&#39;, &#39;MN1&#39;, &#39;MN2&#39;], &quot;line&quot;: &quot;v_center&quot;}</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">instances</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">line</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span>
        <span class="s1">&#39;h_any&#39;</span><span class="p">,</span> <span class="s1">&#39;h_top&#39;</span><span class="p">,</span> <span class="s1">&#39;h_bottom&#39;</span><span class="p">,</span> <span class="s1">&#39;h_center&#39;</span><span class="p">,</span>
        <span class="s1">&#39;v_any&#39;</span><span class="p">,</span> <span class="s1">&#39;v_left&#39;</span><span class="p">,</span> <span class="s1">&#39;v_right&#39;</span><span class="p">,</span> <span class="s1">&#39;v_center&#39;</span>
    <span class="p">]]</span>

    <span class="n">_inst_validator</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">validator</span><span class="p">(</span><span class="s1">&#39;instances&#39;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">validate_instances</span><span class="p">)</span>

<div class="viewcode-block" id="Align.align_instances_validator"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.Align.align_instances_validator">[docs]</a>    <span class="nd">@types</span><span class="o">.</span><span class="n">validator</span><span class="p">(</span><span class="s1">&#39;instances&#39;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">align_instances_validator</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Must contain at least two instances&#39;</span>
        <span class="k">return</span> <span class="n">validate_instances</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Align.translate"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.Align.translate">[docs]</a>    <span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solver</span><span class="p">):</span>
        <span class="n">bvars</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">iter_bbox_vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">pairwise</span><span class="p">(</span><span class="n">bvars</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">line</span> <span class="o">==</span> <span class="s1">&#39;h_top&#39;</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">b1</span><span class="o">.</span><span class="n">ury</span> <span class="o">==</span> <span class="n">b2</span><span class="o">.</span><span class="n">ury</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">line</span> <span class="o">==</span> <span class="s1">&#39;h_bottom&#39;</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">b1</span><span class="o">.</span><span class="n">lly</span> <span class="o">==</span> <span class="n">b2</span><span class="o">.</span><span class="n">lly</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">line</span> <span class="o">==</span> <span class="s1">&#39;h_center&#39;</span><span class="p">:</span>
                <span class="k">yield</span> <span class="p">(</span><span class="n">b1</span><span class="o">.</span><span class="n">lly</span> <span class="o">+</span> <span class="n">b1</span><span class="o">.</span><span class="n">ury</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">==</span> <span class="p">(</span><span class="n">b2</span><span class="o">.</span><span class="n">lly</span> <span class="o">+</span> <span class="n">b2</span><span class="o">.</span><span class="n">ury</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">line</span> <span class="o">==</span> <span class="s1">&#39;h_any&#39;</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">solver</span><span class="o">.</span><span class="n">Or</span><span class="p">(</span>  <span class="c1"># We don&#39;t know which bbox is higher yet</span>
                    <span class="n">solver</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">b1</span><span class="o">.</span><span class="n">lly</span> <span class="o">&gt;=</span> <span class="n">b2</span><span class="o">.</span><span class="n">lly</span><span class="p">,</span> <span class="n">b1</span><span class="o">.</span><span class="n">ury</span> <span class="o">&lt;=</span> <span class="n">b2</span><span class="o">.</span><span class="n">ury</span><span class="p">),</span>
                    <span class="n">solver</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">b2</span><span class="o">.</span><span class="n">lly</span> <span class="o">&gt;=</span> <span class="n">b1</span><span class="o">.</span><span class="n">lly</span><span class="p">,</span> <span class="n">b2</span><span class="o">.</span><span class="n">ury</span> <span class="o">&lt;=</span> <span class="n">b1</span><span class="o">.</span><span class="n">ury</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">line</span> <span class="o">==</span> <span class="s1">&#39;v_left&#39;</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">b1</span><span class="o">.</span><span class="n">llx</span> <span class="o">==</span> <span class="n">b2</span><span class="o">.</span><span class="n">llx</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">line</span> <span class="o">==</span> <span class="s1">&#39;v_right&#39;</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">b1</span><span class="o">.</span><span class="n">urx</span> <span class="o">==</span> <span class="n">b2</span><span class="o">.</span><span class="n">urx</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">line</span> <span class="o">==</span> <span class="s1">&#39;v_center&#39;</span><span class="p">:</span>
                <span class="k">yield</span> <span class="p">(</span><span class="n">b1</span><span class="o">.</span><span class="n">llx</span> <span class="o">+</span> <span class="n">b1</span><span class="o">.</span><span class="n">urx</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">==</span> <span class="p">(</span><span class="n">b2</span><span class="o">.</span><span class="n">llx</span> <span class="o">+</span> <span class="n">b2</span><span class="o">.</span><span class="n">urx</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">line</span> <span class="o">==</span> <span class="s1">&#39;v_any&#39;</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">solver</span><span class="o">.</span><span class="n">Or</span><span class="p">(</span>  <span class="c1"># We don&#39;t know which bbox is wider yet</span>
                    <span class="n">solver</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">b1</span><span class="o">.</span><span class="n">urx</span> <span class="o">&lt;=</span> <span class="n">b2</span><span class="o">.</span><span class="n">urx</span><span class="p">,</span> <span class="n">b1</span><span class="o">.</span><span class="n">llx</span> <span class="o">&gt;=</span> <span class="n">b2</span><span class="o">.</span><span class="n">llx</span><span class="p">),</span>
                    <span class="n">solver</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">b2</span><span class="o">.</span><span class="n">urx</span> <span class="o">&lt;=</span> <span class="n">b1</span><span class="o">.</span><span class="n">urx</span><span class="p">,</span> <span class="n">b2</span><span class="o">.</span><span class="n">llx</span> <span class="o">&gt;=</span> <span class="n">b1</span><span class="o">.</span><span class="n">llx</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">solver</span><span class="o">.</span><span class="n">Or</span><span class="p">(</span>  <span class="c1"># h_any OR v_any</span>
                    <span class="n">solver</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">b1</span><span class="o">.</span><span class="n">urx</span> <span class="o">&lt;=</span> <span class="n">b2</span><span class="o">.</span><span class="n">urx</span><span class="p">,</span> <span class="n">b1</span><span class="o">.</span><span class="n">llx</span> <span class="o">&gt;=</span> <span class="n">b2</span><span class="o">.</span><span class="n">llx</span><span class="p">),</span>
                    <span class="n">solver</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">b2</span><span class="o">.</span><span class="n">urx</span> <span class="o">&lt;=</span> <span class="n">b1</span><span class="o">.</span><span class="n">urx</span><span class="p">,</span> <span class="n">b2</span><span class="o">.</span><span class="n">llx</span> <span class="o">&gt;=</span> <span class="n">b1</span><span class="o">.</span><span class="n">llx</span><span class="p">),</span>
                    <span class="n">solver</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">b1</span><span class="o">.</span><span class="n">lly</span> <span class="o">&gt;=</span> <span class="n">b2</span><span class="o">.</span><span class="n">lly</span><span class="p">,</span> <span class="n">b1</span><span class="o">.</span><span class="n">ury</span> <span class="o">&lt;=</span> <span class="n">b2</span><span class="o">.</span><span class="n">ury</span><span class="p">),</span>
                    <span class="n">solver</span><span class="o">.</span><span class="n">And</span><span class="p">(</span><span class="n">b2</span><span class="o">.</span><span class="n">lly</span> <span class="o">&gt;=</span> <span class="n">b1</span><span class="o">.</span><span class="n">lly</span><span class="p">,</span> <span class="n">b2</span><span class="o">.</span><span class="n">ury</span> <span class="o">&lt;=</span> <span class="n">b1</span><span class="o">.</span><span class="n">ury</span><span class="p">)</span>
                <span class="p">)</span></div></div>


<div class="viewcode-block" id="Enclose"><a class="viewcode-back" href="../../../notes/const.html#align.schema.constraint.Enclose">[docs]</a><span class="k">class</span> <span class="nc">Enclose</span><span class="p">(</span><span class="n">HardConstraint</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Enclose `instances` within a flexible bounding box</span>
<span class="sd">    with `min_` &amp; `max_` bounds</span>

<span class="sd">    Args:</span>
<span class="sd">        instances (list[str], optional): List of `instances`</span>
<span class="sd">        min_height (int, optional):  assign minimum height to the subcircuit</span>
<span class="sd">        max_height (int, optional):  assign maximum height to the subcircuit</span>
<span class="sd">        min_width (int, optional):  assign minimum width to the subcircuit</span>
<span class="sd">        max_width (int, optional):  assign maximum width to the subcircuit</span>
<span class="sd">        min_aspect_ratio (float, optional):  assign minimum aspect ratio to the subcircuit</span>
<span class="sd">        max_aspect_ratio (float, optional):  assign maximum aspect ratio to the subcircuit</span>

<span class="sd">    Note: Specifying any one of the following variables</span>
<span class="sd">    makes it a valid constraint but you may wish to</span>
<span class="sd">    specify more than one for practical purposes</span>

<span class="sd">    Example: ::</span>

<span class="sd">        {&quot;constraint&quot;:&quot;Enclose&quot;, &quot;instances&quot;: [&#39;MN0&#39;, &#39;MN1&#39;, &#39;MN2&#39;], &quot;min_aspect_ratio&quot;: 0.1, &quot;max_aspect_ratio&quot;: 10 }</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">instances</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>
    <span class="n">min_height</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="n">max_height</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="n">min_width</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="n">max_width</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
    <span class="n">min_aspect_ratio</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>
    <span class="n">max_aspect_ratio</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span>

    <span class="n">_inst_validator</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">validator</span><span class="p">(</span><span class="s1">&#39;instances&#39;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">validate_instances</span><span class="p">)</span>

<div class="viewcode-block" id="Enclose.bound_in_box_optional_fields"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.Enclose.bound_in_box_optional_fields">[docs]</a>    <span class="nd">@types</span><span class="o">.</span><span class="n">validator</span><span class="p">(</span><span class="s1">&#39;max_aspect_ratio&#39;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">bound_in_box_optional_fields</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">value</span> <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span>
                <span class="s1">&#39;min_height&#39;</span><span class="p">,</span>
                <span class="s1">&#39;max_height&#39;</span><span class="p">,</span>
                <span class="s1">&#39;min_width&#39;</span><span class="p">,</span>
                <span class="s1">&#39;max_width&#39;</span><span class="p">,</span>
                <span class="s1">&#39;min_aspect_ratio&#39;</span>
            <span class="p">)</span>
        <span class="p">),</span> <span class="s1">&#39;Too many optional fields&#39;</span>
        <span class="k">return</span> <span class="n">value</span></div>

<div class="viewcode-block" id="Enclose.translate"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.Enclose.translate">[docs]</a>    <span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solver</span><span class="p">):</span>
        <span class="n">bb</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">bbox_vars</span><span class="p">(</span><span class="n">solver</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_width</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">bb</span><span class="o">.</span><span class="n">urx</span> <span class="o">-</span> <span class="n">bb</span><span class="o">.</span><span class="n">llx</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_width</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_height</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">bb</span><span class="o">.</span><span class="n">ury</span> <span class="o">-</span> <span class="n">bb</span><span class="o">.</span><span class="n">lly</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_height</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_width</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">bb</span><span class="o">.</span><span class="n">urx</span> <span class="o">-</span> <span class="n">bb</span><span class="o">.</span><span class="n">llx</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_width</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_height</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">bb</span><span class="o">.</span><span class="n">ury</span> <span class="o">-</span> <span class="n">bb</span><span class="o">.</span><span class="n">lly</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_height</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_aspect_ratio</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">solver</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span>
                <span class="p">(</span><span class="n">bb</span><span class="o">.</span><span class="n">ury</span> <span class="o">-</span> <span class="n">bb</span><span class="o">.</span><span class="n">lly</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">bb</span><span class="o">.</span><span class="n">urx</span> <span class="o">-</span> <span class="n">bb</span><span class="o">.</span><span class="n">llx</span><span class="p">),</span>
                <span class="nb">float</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_aspect_ratio</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_aspect_ratio</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">solver</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span>
                <span class="p">(</span><span class="n">bb</span><span class="o">.</span><span class="n">ury</span> <span class="o">-</span> <span class="n">bb</span><span class="o">.</span><span class="n">lly</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">bb</span><span class="o">.</span><span class="n">urx</span> <span class="o">-</span> <span class="n">bb</span><span class="o">.</span><span class="n">llx</span><span class="p">),</span>
                <span class="nb">float</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_aspect_ratio</span>
        <span class="n">bvars</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">iter_bbox_vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bvars</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">b</span><span class="o">.</span><span class="n">urx</span> <span class="o">&lt;=</span> <span class="n">bb</span><span class="o">.</span><span class="n">urx</span>
            <span class="k">yield</span> <span class="n">b</span><span class="o">.</span><span class="n">llx</span> <span class="o">&gt;=</span> <span class="n">bb</span><span class="o">.</span><span class="n">llx</span>
            <span class="k">yield</span> <span class="n">b</span><span class="o">.</span><span class="n">ury</span> <span class="o">&lt;=</span> <span class="n">bb</span><span class="o">.</span><span class="n">ury</span>
            <span class="k">yield</span> <span class="n">b</span><span class="o">.</span><span class="n">lly</span> <span class="o">&gt;=</span> <span class="n">bb</span><span class="o">.</span><span class="n">lly</span></div></div>


<div class="viewcode-block" id="Spread"><a class="viewcode-back" href="../../../notes/const.html#align.schema.constraint.Spread">[docs]</a><span class="k">class</span> <span class="nc">Spread</span><span class="p">(</span><span class="n">HardConstraint</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Spread `instances` by forcing minimum spacing along</span>
<span class="sd">    `direction` if two instances overlap in other direction</span>

<span class="sd">    Args:</span>
<span class="sd">        instances (list[str]): List of `instances`</span>
<span class="sd">        direction (str, optional): Direction for placement spread.</span>
<span class="sd">            (:obj:`&#39;horizontal&#39;` or :obj:`&#39;vertical&#39;` or :obj:`None`)</span>
<span class="sd">        distance (int): Distance in nanometer</span>

<span class="sd">    WARNING: This constraint checks for overlap but</span>
<span class="sd">    doesn&#39;t enforce it (See `Align`)</span>

<span class="sd">    Example: ::</span>

<span class="sd">        {</span>
<span class="sd">            &quot;constraint&quot;: &quot;Spread&quot;,</span>
<span class="sd">            &quot;instances&quot;: [&#39;MN0&#39;, &#39;MN1&#39;, &#39;MN2&#39;],</span>
<span class="sd">            &quot;direction&quot;: horizontal,</span>
<span class="sd">            &quot;distance&quot;: 100</span>
<span class="sd">        }</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">instances</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">direction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="s1">&#39;vertical&#39;</span><span class="p">]]</span>
    <span class="n">distance</span><span class="p">:</span> <span class="nb">int</span>  <span class="c1"># in nm</span>

<div class="viewcode-block" id="Spread.spread_instances_validator"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.Spread.spread_instances_validator">[docs]</a>    <span class="nd">@types</span><span class="o">.</span><span class="n">validator</span><span class="p">(</span><span class="s1">&#39;instances&#39;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">spread_instances_validator</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Must contain at least two instances&#39;</span>
        <span class="k">return</span> <span class="n">validate_instances</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span></div>

<div class="viewcode-block" id="Spread.translate"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.Spread.translate">[docs]</a>    <span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solver</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">cc</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">):</span>
            <span class="n">d</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span> <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s1">&#39;x&#39;</span> <span class="k">else</span> <span class="s1">&#39;x&#39;</span>
            <span class="k">return</span> <span class="n">solver</span><span class="o">.</span><span class="n">Implies</span><span class="p">(</span>
                <span class="n">solver</span><span class="o">.</span><span class="n">And</span><span class="p">(</span>  <span class="c1"># overlap orthogonal to c</span>
                    <span class="nb">getattr</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;ur</span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">b2</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;ll</span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">),</span>
                    <span class="nb">getattr</span><span class="p">(</span><span class="n">b2</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;ur</span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;ll</span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">),</span>
                <span class="p">),</span>
                <span class="n">solver</span><span class="o">.</span><span class="n">Abs</span><span class="p">(</span>  <span class="c1"># distance in c coords</span>
                    <span class="p">(</span>
                        <span class="nb">getattr</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;ll</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                        <span class="o">+</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;ur</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="p">)</span> <span class="o">-</span> <span class="p">(</span>
                        <span class="nb">getattr</span><span class="p">(</span><span class="n">b2</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;ll</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                        <span class="o">+</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">b2</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;ur</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance</span> <span class="o">*</span> <span class="mi">2</span>
            <span class="p">)</span>

        <span class="n">bvars</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">iter_bbox_vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">pairwise</span><span class="p">(</span><span class="n">bvars</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">cc</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;vertical&#39;</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">cc</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">solver</span><span class="o">.</span><span class="n">Or</span><span class="p">(</span>
                    <span class="n">cc</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">),</span>
                    <span class="n">cc</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">)</span>
                <span class="p">)</span></div></div>


<div class="viewcode-block" id="AssignBboxVariables"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.AssignBboxVariables">[docs]</a><span class="k">class</span> <span class="nc">AssignBboxVariables</span><span class="p">(</span><span class="n">HardConstraint</span><span class="p">):</span>
    <span class="n">bbox_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">llx</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">lly</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">urx</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">ury</span><span class="p">:</span> <span class="nb">int</span>

<div class="viewcode-block" id="AssignBboxVariables.x_is_valid"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.AssignBboxVariables.x_is_valid">[docs]</a>    <span class="nd">@types</span><span class="o">.</span><span class="n">validator</span><span class="p">(</span><span class="s1">&#39;urx&#39;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">x_is_valid</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;llx&#39;</span><span class="p">],</span> <span class="s1">&#39;Reflection is not supported yet&#39;</span>
        <span class="k">return</span> <span class="n">value</span></div>

<div class="viewcode-block" id="AssignBboxVariables.y_is_valid"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.AssignBboxVariables.y_is_valid">[docs]</a>    <span class="nd">@types</span><span class="o">.</span><span class="n">validator</span><span class="p">(</span><span class="s1">&#39;ury&#39;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">y_is_valid</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;lly&#39;</span><span class="p">],</span> <span class="s1">&#39;Reflection is not supported yet&#39;</span>
        <span class="k">return</span> <span class="n">value</span></div>

<div class="viewcode-block" id="AssignBboxVariables.translate"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.AssignBboxVariables.translate">[docs]</a>    <span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solver</span><span class="p">):</span>
        <span class="n">bvar</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">bbox_vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bbox_name</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">bvar</span><span class="o">.</span><span class="n">llx</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">llx</span>
        <span class="k">yield</span> <span class="n">bvar</span><span class="o">.</span><span class="n">lly</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">lly</span>
        <span class="k">yield</span> <span class="n">bvar</span><span class="o">.</span><span class="n">urx</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">urx</span>
        <span class="k">yield</span> <span class="n">bvar</span><span class="o">.</span><span class="n">ury</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ury</span></div></div>


<div class="viewcode-block" id="AspectRatio"><a class="viewcode-back" href="../../../notes/const.html#align.schema.constraint.AspectRatio">[docs]</a><span class="k">class</span> <span class="nc">AspectRatio</span><span class="p">(</span><span class="n">HardConstraint</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define lower and upper bounds on aspect ratio (=width/height) of a subcircuit</span>

<span class="sd">    `ratio_low` &lt;= width/height &lt;= `ratio_high`</span>

<span class="sd">    Args:</span>
<span class="sd">        subcircuit (str) : Name of subciruit</span>
<span class="sd">        ratio_low (float): Minimum aspect ratio (default 0.1)</span>
<span class="sd">        ratio_high (float): Maximum aspect ratio (default 10)</span>
<span class="sd">        weight (int): Weigth of this constraint (default 1)</span>

<span class="sd">    Example: ::</span>

<span class="sd">        {&quot;constraint&quot;: &quot;AspectRatio&quot;, &quot;ratio_low&quot;: 0.1, &quot;ratio_high&quot;: 10, &quot;weight&quot;: 1 }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">subcircuit</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">ratio_low</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="n">ratio_high</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">10</span>
    <span class="n">weight</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">_ratio_low_validator</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">validator</span><span class="p">(</span><span class="s1">&#39;ratio_low&#39;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">assert_non_negative</span><span class="p">)</span>

<div class="viewcode-block" id="AspectRatio.ratio_high_validator"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.AspectRatio.ratio_high_validator">[docs]</a>    <span class="nd">@types</span><span class="o">.</span><span class="n">validator</span><span class="p">(</span><span class="s1">&#39;ratio_high&#39;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">ratio_high_validator</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">value</span> <span class="o">&gt;</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;ratio_low&#39;</span><span class="p">],</span> <span class="sa">f</span><span class="s1">&#39;AspectRatio:ratio_high </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1"> should be greater than ratio_low </span><span class="si">{</span><span class="n">values</span><span class="p">[</span><span class="s2">&quot;ratio_low&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">value</span></div>

<div class="viewcode-block" id="AspectRatio.translate"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.AspectRatio.translate">[docs]</a>    <span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solver</span><span class="p">):</span>
        <span class="n">bvar</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">bbox_vars</span><span class="p">(</span><span class="s1">&#39;subcircuit&#39;</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">solver</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">bvar</span><span class="o">.</span><span class="n">urx</span><span class="o">-</span><span class="n">bvar</span><span class="o">.</span><span class="n">llx</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratio_low</span> <span class="o">*</span> <span class="n">solver</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">bvar</span><span class="o">.</span><span class="n">ury</span><span class="o">-</span><span class="n">bvar</span><span class="o">.</span><span class="n">lly</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">solver</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">bvar</span><span class="o">.</span><span class="n">urx</span><span class="o">-</span><span class="n">bvar</span><span class="o">.</span><span class="n">llx</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">ratio_high</span> <span class="o">*</span> <span class="n">solver</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">bvar</span><span class="o">.</span><span class="n">ury</span><span class="o">-</span><span class="n">bvar</span><span class="o">.</span><span class="n">lly</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span></div></div>


<div class="viewcode-block" id="Boundary"><a class="viewcode-back" href="../../../notes/const.html#align.schema.constraint.Boundary">[docs]</a><span class="k">class</span> <span class="nc">Boundary</span><span class="p">(</span><span class="n">HardConstraint</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define `max_height` and/or `max_width` on a subcircuit in micrometers.</span>

<span class="sd">    Args:</span>
<span class="sd">        subcircuit (str) : Name of subcircuit</span>
<span class="sd">        max_width (float, Optional) = 10000</span>
<span class="sd">        max_height (float, Optional) = 10000</span>

<span class="sd">    Example: ::</span>

<span class="sd">        {&quot;constraint&quot;: &quot;Boundary&quot;, &quot;subcircuit&quot;: &quot;OTA&quot;, &quot;max_height&quot;: 100 }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">subcircuit</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">max_width</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span>
    <span class="n">max_height</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10000</span>

    <span class="n">_max_width</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">validator</span><span class="p">(</span><span class="s1">&#39;max_width&#39;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">assert_non_negative</span><span class="p">)</span>
    <span class="n">_max_height</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">validator</span><span class="p">(</span><span class="s1">&#39;max_height&#39;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">assert_non_negative</span><span class="p">)</span>

<div class="viewcode-block" id="Boundary.translate"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.Boundary.translate">[docs]</a>    <span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solver</span><span class="p">):</span>
        <span class="n">bvar</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">bbox_vars</span><span class="p">(</span><span class="s1">&#39;subcircuit&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">solver</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">bvar</span><span class="o">.</span><span class="n">urx</span><span class="o">-</span><span class="n">bvar</span><span class="o">.</span><span class="n">llx</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1000</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">max_width</span>  <span class="c1"># in nanometer</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_height</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">solver</span><span class="o">.</span><span class="n">cast</span><span class="p">(</span><span class="n">bvar</span><span class="o">.</span><span class="n">ury</span><span class="o">-</span><span class="n">bvar</span><span class="o">.</span><span class="n">lly</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1000</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">max_height</span>  <span class="c1"># in nanometer</span></div></div>


<div class="viewcode-block" id="GroupBlocks"><a class="viewcode-back" href="../../../notes/const.html#align.schema.constraint.GroupBlocks">[docs]</a><span class="k">class</span> <span class="nc">GroupBlocks</span><span class="p">(</span><span class="n">HardConstraint</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;GroupBlocks</span>

<span class="sd">    Forces a hierarchy creation for group of instances.</span>
<span class="sd">    This brings the instances closer.</span>
<span class="sd">    This reduces the problem statement for placer thus providing</span>
<span class="sd">    better solutions.</span>

<span class="sd">    Args:</span>
<span class="sd">      instances (list[str]): List of :obj:`instances`</span>
<span class="sd">      name (str): alias for the list of :obj:`instances`</span>
<span class="sd">      generator (dict): adds a generator constraint to the created groupblock, look into the generator constraint for more options</span>

<span class="sd">    Example: ::</span>

<span class="sd">        {</span>
<span class="sd">            &quot;constraint&quot;:&quot;GroupBlocks&quot;,</span>
<span class="sd">            &quot;name&quot;: &quot;group1&quot;,</span>
<span class="sd">            &quot;instances&quot;: [&quot;MN0&quot;, &quot;MN1&quot;, &quot;MN3&quot;]</span>
<span class="sd">            &quot;generator&quot;: {name: &#39;MOS&#39;,</span>
<span class="sd">                        &#39;parameters&#39;:</span>
<span class="sd">                            {</span>
<span class="sd">                            &quot;pattern&quot;: &quot;cc&quot;,</span>
<span class="sd">                            }</span>
<span class="sd">                        }</span>
<span class="sd">        }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">instances</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">generator</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span>

<div class="viewcode-block" id="GroupBlocks.group_block_name"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.GroupBlocks.group_block_name">[docs]</a>    <span class="nd">@types</span><span class="o">.</span><span class="n">validator</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">group_block_name</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">value</span><span class="p">,</span> <span class="s1">&#39;Cannot be an empty string&#39;</span>
        <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span></div>

<div class="viewcode-block" id="GroupBlocks.translate"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.GroupBlocks.translate">[docs]</a>    <span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">solver</span><span class="p">):</span>
        <span class="c1"># Non-zero width / height</span>
        <span class="n">bb</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">bbox_vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">bb</span><span class="o">.</span><span class="n">llx</span> <span class="o">&lt;</span> <span class="n">bb</span><span class="o">.</span><span class="n">urx</span>
        <span class="k">yield</span> <span class="n">bb</span><span class="o">.</span><span class="n">lly</span> <span class="o">&lt;</span> <span class="n">bb</span><span class="o">.</span><span class="n">ury</span>
        <span class="c1"># Grouping into common bbox</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">solver</span><span class="o">.</span><span class="n">iter_bbox_vars</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">b</span><span class="o">.</span><span class="n">urx</span> <span class="o">&lt;=</span> <span class="n">bb</span><span class="o">.</span><span class="n">urx</span>
            <span class="k">yield</span> <span class="n">b</span><span class="o">.</span><span class="n">llx</span> <span class="o">&gt;=</span> <span class="n">bb</span><span class="o">.</span><span class="n">llx</span>
            <span class="k">yield</span> <span class="n">b</span><span class="o">.</span><span class="n">ury</span> <span class="o">&lt;=</span> <span class="n">bb</span><span class="o">.</span><span class="n">ury</span>
            <span class="k">yield</span> <span class="n">b</span><span class="o">.</span><span class="n">lly</span> <span class="o">&gt;=</span> <span class="n">bb</span><span class="o">.</span><span class="n">lly</span>
        <span class="n">instances</span> <span class="o">=</span> <span class="n">get_instances_from_hacked_dataclasses</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">solver</span><span class="o">.</span><span class="n">iter_bbox_vars</span><span class="p">((</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">instances</span> <span class="k">if</span> <span class="n">x</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="p">)):</span>
            <span class="k">yield</span> <span class="n">solver</span><span class="o">.</span><span class="n">Or</span><span class="p">(</span>
                <span class="n">b</span><span class="o">.</span><span class="n">urx</span> <span class="o">&lt;=</span> <span class="n">bb</span><span class="o">.</span><span class="n">llx</span><span class="p">,</span>
                <span class="n">bb</span><span class="o">.</span><span class="n">urx</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="o">.</span><span class="n">llx</span><span class="p">,</span>
                <span class="n">b</span><span class="o">.</span><span class="n">ury</span> <span class="o">&lt;=</span> <span class="n">bb</span><span class="o">.</span><span class="n">lly</span><span class="p">,</span>
                <span class="n">bb</span><span class="o">.</span><span class="n">ury</span> <span class="o">&lt;=</span> <span class="n">b</span><span class="o">.</span><span class="n">lly</span><span class="p">,</span>
            <span class="p">)</span></div></div>

<span class="c1"># You may chain constraints together for more complex constraints by</span>
<span class="c1">#     1) Assigning default values to certain attributes</span>
<span class="c1">#     2) Using custom validators to modify attribute values</span>
<span class="c1"># Note: Do not implement translate() here as it may be ignored</span>
<span class="c1">#       by certain engines</span>


<div class="viewcode-block" id="AlignInOrder"><a class="viewcode-back" href="../../../notes/const.html#align.schema.constraint.AlignInOrder">[docs]</a><span class="k">class</span> <span class="nc">AlignInOrder</span><span class="p">(</span><span class="n">UserConstraint</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Align `instances` on `line` ordered along `direction`</span>

<span class="sd">    Args:</span>
<span class="sd">        instances (list[str]): List of :obj:`instances`</span>
<span class="sd">        line (str, optional): The following `line` values are currently supported:</span>

<span class="sd">            :obj:`&#39;top&#39;`, align instance&#39;s horizontally based on top.</span>

<span class="sd">            :obj:`&#39;bottom&#39;`, align instance&#39;s horizomtally based on bottom.</span>

<span class="sd">            :obj:`&#39;center&#39;`, align instance&#39;s horizontally based on center.</span>

<span class="sd">            :obj:`&#39;left&#39;`, align instance&#39;s vertically based on left.</span>

<span class="sd">            :obj:`&#39;right&#39;`, align instance&#39;s vertically based on right.</span>
<span class="sd">        direction: The following `direction` values are supported:</span>

<span class="sd">            :obj: `&#39;horizontal&#39;`, left to right</span>

<span class="sd">            :obj: `&#39;vertical&#39;`, bottom to top</span>

<span class="sd">    Example: ::</span>

<span class="sd">        {</span>
<span class="sd">            &quot;constraint&quot;:&quot;Align&quot;,</span>
<span class="sd">            &quot;instances&quot;: [&quot;MN0&quot;, &quot;MN1&quot;, &quot;MN3&quot;],</span>
<span class="sd">            &quot;line&quot;: &quot;center&quot;,</span>
<span class="sd">            &quot;direction&quot;: &quot;horizontal&quot;</span>
<span class="sd">        }</span>

<span class="sd">    Note: This is a user-convenience constraint. Same</span>
<span class="sd">    effect can be realized using `Order` &amp; `Align`</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">instances</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">line</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span>
        <span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span><span class="p">,</span>
        <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">,</span>
        <span class="s1">&#39;center&#39;</span>
    <span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
    <span class="n">direction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="s1">&#39;vertical&#39;</span><span class="p">]]</span>
    <span class="n">abut</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@types</span><span class="o">.</span><span class="n">validator</span><span class="p">(</span><span class="s1">&#39;direction&#39;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_direction_depends_on_line</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="c1"># Process unambiguous line values</span>
        <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="s1">&#39;top&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="s1">&#39;horizontal&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">v</span> <span class="o">==</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> \
                    <span class="s1">&#39;direction is horizontal if line is bottom or top&#39;</span>
        <span class="k">elif</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="s1">&#39;vertical&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">assert</span> <span class="n">v</span> <span class="o">==</span> <span class="s1">&#39;vertical&#39;</span><span class="p">,</span> \
                    <span class="s1">&#39;direction is vertical if line is left or right&#39;</span>
        <span class="c1"># Center needs both line &amp; direction</span>
        <span class="k">elif</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;center&#39;</span><span class="p">:</span>
            <span class="k">assert</span> <span class="n">v</span><span class="p">,</span> \
                <span class="s1">&#39;direction must be specified if line == center&#39;</span>
        <span class="k">return</span> <span class="n">v</span>

<div class="viewcode-block" id="AlignInOrder.yield_constraints"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.AlignInOrder.yield_constraints">[docs]</a>    <span class="k">def</span> <span class="nf">yield_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">with</span> <span class="n">set_context</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">Align</span><span class="p">(</span>
                <span class="n">instances</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="p">,</span>
                <span class="n">line</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">direction</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="p">)</span>
            <span class="k">yield</span> <span class="n">Order</span><span class="p">(</span>
                <span class="n">instances</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">instances</span><span class="p">,</span>
                <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;left_to_right&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;horizontal&#39;</span> <span class="k">else</span> <span class="s1">&#39;top_to_bottom&#39;</span><span class="p">,</span>
                <span class="n">abut</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">abut</span>
            <span class="p">)</span></div></div>


<div class="viewcode-block" id="Floorplan"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.Floorplan">[docs]</a><span class="k">class</span> <span class="nc">Floorplan</span><span class="p">(</span><span class="n">UserConstraint</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Row-based layout floorplan from top to bottom</span>
<span class="sd">    Instances on each row are ordered from left to right.</span>

<span class="sd">    Example: Define three regions and assign each instance to a region:</span>
<span class="sd">        {&quot;constraint&quot;:&quot;Floorplan&quot;, &quot;regions&quot;: [[&quot;A&quot;, &quot;B&quot;, &quot;C&quot;], [&quot;D&quot;, &quot;E&quot;], [&quot;G&quot;], &quot;order&quot;: true}</span>

<span class="sd">        -----</span>
<span class="sd">        A B C</span>
<span class="sd">        -----</span>
<span class="sd">        D E</span>
<span class="sd">        -----</span>
<span class="sd">        G</span>
<span class="sd">        -----</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">regions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>
    <span class="n">order</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">symmetrize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="nd">@types</span><span class="o">.</span><span class="n">validator</span><span class="p">(</span><span class="s1">&#39;regions&#39;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">always</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_check_instance</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">new_rows</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">new_rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">validate_instances</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">row</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">new_rows</span>

<div class="viewcode-block" id="Floorplan.yield_constraints"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.Floorplan.yield_constraints">[docs]</a>    <span class="k">def</span> <span class="nf">yield_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">above_below</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">with</span> <span class="n">set_context</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_parent</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;=== Floorplan ========================&quot;</span><span class="p">)</span>
            <span class="c1"># Regions from top to bottom</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;===========================&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regions</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="k">for</span> <span class="p">[</span><span class="n">above</span><span class="p">,</span> <span class="n">below</span><span class="p">]</span> <span class="ow">in</span> <span class="n">plain_itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regions</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">regions</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]):</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Above:</span><span class="si">{</span><span class="n">above</span><span class="si">}</span><span class="s1"> Below:</span><span class="si">{</span><span class="n">below</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="n">above_below</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">above</span><span class="p">,</span> <span class="n">below</span><span class="p">))</span>
                    <span class="k">assert</span> <span class="p">(</span><span class="n">below</span><span class="p">,</span> <span class="n">above</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">above_below</span><span class="p">,</span> \
                        <span class="sa">f</span><span class="s1">&#39;Please review floorplan constraint:</span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">regions</span><span class="si">}</span><span class="s1">.</span><span class="se">\n</span><span class="si">{</span><span class="n">below</span><span class="si">}</span><span class="s1"> is previously placed above </span><span class="si">{</span><span class="n">above</span><span class="si">}</span><span class="s1">.&#39;</span>
                    <span class="k">yield</span> <span class="n">Order</span><span class="p">(</span><span class="n">instances</span><span class="o">=</span><span class="p">[</span><span class="n">above</span><span class="p">,</span> <span class="n">below</span><span class="p">],</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;top_to_bottom&#39;</span><span class="p">,</span> <span class="n">abut</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="c1"># Order instances in each region from left to right</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">order</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;===========================&quot;</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">regions</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Order left to right: </span><span class="si">{</span><span class="n">region</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">region</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="k">yield</span> <span class="n">Order</span><span class="p">(</span><span class="n">instances</span><span class="o">=</span><span class="n">region</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;left_to_right&#39;</span><span class="p">,</span> <span class="n">abut</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="c1"># Symmetrize instances along a single vertical line</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">symmetrize</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;===========================&quot;</span><span class="p">)</span>
                <span class="n">pairs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
                <span class="k">for</span> <span class="n">region</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">regions</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">region</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">pairs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">region</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">region</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">):</span>
                            <span class="n">pairs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">region</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">region</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">i</span><span class="p">]])</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">region</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">pairs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">region</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]])</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Symmetric blocks:</span><span class="se">\n</span><span class="si">{</span><span class="n">pairs</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="k">yield</span> <span class="n">SymmetricBlocks</span><span class="p">(</span><span class="n">pairs</span><span class="o">=</span><span class="n">pairs</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;V&#39;</span><span class="p">)</span></div></div>


<span class="c1">#</span>
<span class="c1"># list of &#39;SoftConstraint&#39;</span>
<span class="c1">#</span>
<span class="c1"># Below is a list of legacy constraints</span>
<span class="c1"># that have not been hardened yet</span>
<span class="c1">#</span>


<div class="viewcode-block" id="PlaceSymmetric"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.PlaceSymmetric">[docs]</a><span class="k">class</span> <span class="nc">PlaceSymmetric</span><span class="p">(</span><span class="n">SoftConstraint</span><span class="p">):</span>
    <span class="c1"># TODO: Finish implementing this. Not registered to</span>
    <span class="c1">#       ConstraintDB yet</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Place instance / pair of `instances` symmetrically</span>
<span class="sd">    around line of symmetry along `direction`</span>

<span class="sd">    Note: This is a user-convenience constraint. Same</span>
<span class="sd">    effect can be realized using `Align` &amp; `Group`</span>

<span class="sd">    For example:</span>
<span class="sd">    `instances` = [[&#39;1&#39;], [&#39;4&#39;, &#39;5&#39;], [&#39;2&#39;, &#39;3&#39;], [&#39;6&#39;]]</span>
<span class="sd">    `direction` = &#39;vertical&#39;</span>
<span class="sd">       1   |  5 4  |   6   |  4 5  |   1   |  5 4</span>
<span class="sd">      4 5  |   1   |  5 4  |   6   |   6   |   1</span>
<span class="sd">      2 3  |  2 3  |  3 2  |   1   |  5 4  |   6</span>
<span class="sd">       6   |   6   |   1   |  2 3  |  2 3  |  3 2</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">instances</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>
    <span class="n">direction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="s1">&#39;vertical&#39;</span><span class="p">]]</span>

<div class="viewcode-block" id="PlaceSymmetric.place_symmetric_instances_validator"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.PlaceSymmetric.place_symmetric_instances_validator">[docs]</a>    <span class="nd">@types</span><span class="o">.</span><span class="n">validator</span><span class="p">(</span><span class="s1">&#39;instances&#39;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">place_symmetric_instances_validator</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        X = Align(2, 3, &#39;h_center&#39;)</span>
<span class="sd">        Y = Align(4, 5, &#39;h_center&#39;)</span>
<span class="sd">        Align(1, X, Y, 6, &#39;center&#39;)</span>

<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Must contain at least one instance&#39;</span>
        <span class="k">assert</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">List</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">value</span><span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;All arguments must be of type list in </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">instances</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">value</span></div></div>


<div class="viewcode-block" id="CompactPlacement"><a class="viewcode-back" href="../../../notes/const.html#align.schema.constraint.CompactPlacement">[docs]</a><span class="k">class</span> <span class="nc">CompactPlacement</span><span class="p">(</span><span class="n">SoftConstraint</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;CompactPlacement</span>

<span class="sd">    Defines snapping position of placement for all blocks in design.</span>

<span class="sd">    Args:</span>
<span class="sd">        style (str): Following options are available.</span>

<span class="sd">            :obj:`&#39;left&#39;`, Moves all instances towards left during post-processing of placement.</span>

<span class="sd">            :obj:`&#39;right&#39;`, Moves all instances towards right during post-processing of placement.</span>

<span class="sd">            :obj:`&#39;center&#39;`, Moves all instances towards center during post-processing of placement.</span>

<span class="sd">    Example: ::</span>

<span class="sd">        {&quot;constraint&quot;: &quot;CompactPlacement&quot;, &quot;style&quot;: &quot;center&quot;}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">style</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span>
        <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">,</span>
        <span class="s1">&#39;center&#39;</span>
    <span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span></div>


<div class="viewcode-block" id="SameTemplate"><a class="viewcode-back" href="../../../notes/const.html#align.schema.constraint.SameTemplate">[docs]</a><span class="k">class</span> <span class="nc">SameTemplate</span><span class="p">(</span><span class="n">SoftConstraint</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;SameTemplate</span>

<span class="sd">    Makes identical copy of all isntances</span>

<span class="sd">    Args:</span>
<span class="sd">        instances (list[str]): List of :obj:`instances`</span>

<span class="sd">    Example: ::</span>

<span class="sd">        {&quot;constraint&quot;:&quot;SameTemplate&quot;, &quot;instances&quot;: [&quot;MN0&quot;, &quot;MN1&quot;, &quot;MN3&quot;]}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">instances</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></div>


<div class="viewcode-block" id="CreateAlias"><a class="viewcode-back" href="../../../notes/const.html#align.schema.constraint.CreateAlias">[docs]</a><span class="k">class</span> <span class="nc">CreateAlias</span><span class="p">(</span><span class="n">SoftConstraint</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;CreateAlias</span>

<span class="sd">    Creates an alias for list of instances. You can use this</span>
<span class="sd">    alias later while defining constraints</span>

<span class="sd">    Args:</span>
<span class="sd">      instances (list[str]): List of :obj:`instances`</span>
<span class="sd">      name (str): alias for the list of :obj:`instances`</span>

<span class="sd">    Example: ::</span>

<span class="sd">        {</span>
<span class="sd">            &quot;constraint&quot;:&quot;CreateAlias&quot;,</span>
<span class="sd">            &quot;instances&quot;: [&quot;MN0&quot;, &quot;MN1&quot;, &quot;MN3&quot;],</span>
<span class="sd">            &quot;name&quot;: &quot;alias1&quot;</span>
<span class="sd">        }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">instances</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span></div>


<div class="viewcode-block" id="PlaceCloser"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.PlaceCloser">[docs]</a><span class="k">class</span> <span class="nc">PlaceCloser</span><span class="p">(</span><span class="n">SoftConstraint</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        `instances` are preferred to be placed closer.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">instances</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">_inst_validator</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">validator</span><span class="p">(</span><span class="s1">&#39;instances&#39;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">validate_instances</span><span class="p">)</span></div>


<div class="viewcode-block" id="PowerPorts"><a class="viewcode-back" href="../../../notes/const.html#align.schema.constraint.PowerPorts">[docs]</a><span class="k">class</span> <span class="nc">PowerPorts</span><span class="p">(</span><span class="n">SoftConstraint</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Defines power ports for each hieararchy</span>

<span class="sd">    Args:</span>
<span class="sd">        ports (list[str]): List of :obj:`ports`.</span>
<span class="sd">            The first port of top hierarchy will be used for power grid creation.</span>
<span class="sd">            Power ports are used to identify source and drain of transistors</span>
<span class="sd">            by identifying the terminal at higher potential.</span>

<span class="sd">    Example: ::</span>

<span class="sd">        {</span>
<span class="sd">            &quot;constraint&quot;:&quot;PowerPorts&quot;,</span>
<span class="sd">            &quot;ports&quot;: [&quot;VDD&quot;, &quot;VDD1&quot;],</span>
<span class="sd">        }</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">ports</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

    <span class="n">_upper_case</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">validator</span><span class="p">(</span><span class="s1">&#39;ports&#39;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">upper_case</span><span class="p">)</span></div>


<div class="viewcode-block" id="GroundPorts"><a class="viewcode-back" href="../../../notes/const.html#align.schema.constraint.GroundPorts">[docs]</a><span class="k">class</span> <span class="nc">GroundPorts</span><span class="p">(</span><span class="n">SoftConstraint</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Ground port for each hieararchy</span>

<span class="sd">    Args:</span>
<span class="sd">        ports (list[str]): List of :obj:`ports`.</span>
<span class="sd">            The first port of top hierarchy will be used for ground grid creation.</span>
<span class="sd">            Power ports are used to identify source and drain of transistors</span>
<span class="sd">            by identifying the terminal at higher potential.</span>

<span class="sd">    Example: ::</span>

<span class="sd">        {</span>
<span class="sd">            &quot;constraint&quot;: &quot;GroundPorts&quot;,</span>
<span class="sd">            &quot;ports&quot;: [&quot;GND&quot;, &quot;GNVD1&quot;],</span>
<span class="sd">        }</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">ports</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

    <span class="n">_upper_case</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">validator</span><span class="p">(</span><span class="s1">&#39;ports&#39;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">upper_case</span><span class="p">)</span></div>


<div class="viewcode-block" id="ClockPorts"><a class="viewcode-back" href="../../../notes/const.html#align.schema.constraint.ClockPorts">[docs]</a><span class="k">class</span> <span class="nc">ClockPorts</span><span class="p">(</span><span class="n">SoftConstraint</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Clock port for each hieararchy. These are used as stop-points</span>
<span class="sd">    during auto-constraint identification, means no constraint search</span>
<span class="sd">    will be done beyond the nets connected to these ports.</span>

<span class="sd">    Args:</span>
<span class="sd">        ports (list[str]): List of :obj:`ports`.</span>

<span class="sd">    Example: ::</span>

<span class="sd">        {</span>
<span class="sd">            &quot;constraint&quot;: &quot;ClockPorts&quot;,</span>
<span class="sd">            &quot;ports&quot;: [&quot;CLK1&quot;, &quot;CLK2&quot;],</span>
<span class="sd">        }</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">ports</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

    <span class="n">_upper_case</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">validator</span><span class="p">(</span><span class="s1">&#39;ports&#39;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">upper_case</span><span class="p">)</span></div>


<div class="viewcode-block" id="DoNotUseLib"><a class="viewcode-back" href="../../../notes/const.html#align.schema.constraint.DoNotUseLib">[docs]</a><span class="k">class</span> <span class="nc">DoNotUseLib</span><span class="p">(</span><span class="n">SoftConstraint</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Primitive libraries which should not be used during hierarchy annotation.</span>

<span class="sd">    Args:</span>
<span class="sd">        libraries (list[str]): List of :obj:`libraries`.</span>
<span class="sd">        propagate: Copy this constraint to sub-hierarchies</span>

<span class="sd">    Example: ::</span>

<span class="sd">        {</span>
<span class="sd">            &quot;constraint&quot;: &quot;DoNotUseLib&quot;,</span>
<span class="sd">            &quot;libraries&quot;: [&quot;DP_NMOS&quot;, &quot;INV&quot;],</span>
<span class="sd">            &quot;propagate&quot;: false</span>
<span class="sd">        }</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">libraries</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">propagate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="ConfigureCompiler"><a class="viewcode-back" href="../../../notes/const.html#align.schema.constraint.ConfigureCompiler">[docs]</a><span class="k">class</span> <span class="nc">ConfigureCompiler</span><span class="p">(</span><span class="n">SoftConstraint</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Compiler default optimization flags</span>

<span class="sd">    Args:</span>
<span class="sd">        is_digital(bool): true/false , stops any annotation or constraint generation</span>
<span class="sd">        auto_constraint(bool): true/false , stops auto-symmetry-constraint identification</span>
<span class="sd">        identify_array(bool): true/false , stops array identification</span>
<span class="sd">        fix_source_drain(bool): true/false , ensures (drain of NMOS/ source of PMOS) is at higher potential.</span>
<span class="sd">        remove_dummy_hierarchies(bool): true/false , Removes any single instance hierarchies.</span>
<span class="sd">        remove_dummy_devices(bool): true/false , Removes dummy devices in the design.</span>
<span class="sd">        merge_series_devices(bool): true/false , stack series devices</span>
<span class="sd">        merge_parallel_devices(bool): true/false , merge parallel devices</span>
<span class="sd">        propagate(bool): true/false , propagates these constarints to lower hierarchies</span>

<span class="sd">    Example: ::</span>

<span class="sd">        {</span>
<span class="sd">            &quot;constraint&quot;: &quot;ConfigureCompiler&quot;,</span>
<span class="sd">            &quot;is_digital&quot;: true,</span>
<span class="sd">            &quot;remove_dummy_hierarchies&quot;: true,</span>
<span class="sd">            &quot;propagate&quot;: true</span>
<span class="sd">        }</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">is_digital</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Annotation and auto-constraint generation</span>
    <span class="n">auto_constraint</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Auto-constraint generation</span>
    <span class="n">identify_array</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Forbids/Allow any array identification</span>
    <span class="n">fix_source_drain</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Auto correction of source/drain terminals of transistors.</span>
    <span class="n">remove_dummy_hierarchies</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Removes any single instance hierarchies.</span>
    <span class="n">remove_dummy_devices</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Removes dummy transistors</span>
    <span class="n">merge_series_devices</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Merge series/stacked MOS/RES/CAP</span>
    <span class="n">merge_parallel_devices</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Merge parallel devices</span>
    <span class="n">propagate</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># propagate constraint to all lower hierarchies</span></div>


<div class="viewcode-block" id="Generator"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.Generator">[docs]</a><span class="k">class</span> <span class="nc">Generator</span><span class="p">(</span><span class="n">SoftConstraint</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Used to guide primitive generator.</span>
<span class="sd">    Args:</span>
<span class="sd">        name(str): name of genrator e.g., mos/cap/res/ring</span>
<span class="sd">        parameters(dict): {</span>
<span class="sd">                            pattern (str): common centroid (cc)/ Inter digitated (id)/Non common centroid (ncc)</span>
<span class="sd">                            parallel_wires (dict): {net_name:2}</span>
<span class="sd">                            body (bool): true/ false</span>
<span class="sd">                            }</span>

<span class="sd">    Example: ::</span>

<span class="sd">        {</span>
<span class="sd">            &quot;constraint&quot;: &quot;Generator&quot;,</span>
<span class="sd">            &quot;name&quot;: &quot;mos&quot;,</span>
<span class="sd">            &quot;parameters : {</span>
<span class="sd">                            &quot;pattern&quot;: &quot;cc&quot;,</span>
<span class="sd">                            &quot;parallel_wires&quot;: {&quot;net1&quot;:2, &quot;net2&quot;:2},</span>
<span class="sd">                            &quot;body&quot;: true</span>
<span class="sd">                            }</span>
<span class="sd">        }</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">parameters</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span></div>


<div class="viewcode-block" id="DoNotIdentify"><a class="viewcode-back" href="../../../notes/const.html#align.schema.constraint.DoNotIdentify">[docs]</a><span class="k">class</span> <span class="nc">DoNotIdentify</span><span class="p">(</span><span class="n">SoftConstraint</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Stop any auto-grouping of provided instances</span>
<span class="sd">    Automatically adds instances from all constraint</span>

<span class="sd">    WARNING: user-defined `groupblock`/`groupcap` constraint will ignore this constraint</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">instances</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span></div>


<div class="viewcode-block" id="SymmetricBlocks"><a class="viewcode-back" href="../../../notes/const.html#align.schema.constraint.SymmetricBlocks">[docs]</a><span class="k">class</span> <span class="nc">SymmetricBlocks</span><span class="p">(</span><span class="n">HardConstraint</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;SymmetricBlocks</span>

<span class="sd">    Defines a symmetry constraint between single and/or pairs of blocks.</span>

<span class="sd">    Args:</span>
<span class="sd">        pairs (list[list[str]]): List of pair of instances.</span>
<span class="sd">            A pair can have one :obj:`instance` or two instances,</span>
<span class="sd">            where single instance implies self-symmetry</span>
<span class="sd">        direction (str) : Direction for axis of symmetry. Literal::</span>

<span class="sd">            [&#39;V&#39;, &#39;H&#39;]</span>

<span class="sd">    .. image:: ../images/SymmetricBlocks.PNG</span>
<span class="sd">        :align: center</span>

<span class="sd">    Example: ::</span>

<span class="sd">        {</span>
<span class="sd">            &quot;constraint&quot; : &quot;SymmetricBlocks&quot;,</span>
<span class="sd">            &quot;pairs&quot; : [[&quot;MN0&quot;,&quot;MN1&quot;], [&quot;MN2&quot;,&quot;MN3&quot;], [&quot;MN4&quot;]],</span>
<span class="sd">            &quot;direction&quot; : &quot;V&quot;</span>
<span class="sd">        }</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pairs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span>
    <span class="n">direction</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">]</span>

<div class="viewcode-block" id="SymmetricBlocks.pairs_validator"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.SymmetricBlocks.pairs_validator">[docs]</a>    <span class="nd">@types</span><span class="o">.</span><span class="n">validator</span><span class="p">(</span><span class="s1">&#39;pairs&#39;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">pairs_validator</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">get_instances_from_hacked_dataclasses</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_validator_ctx</span><span class="p">())</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Must contain at least a pair of two instances or more than two pairs.&#39;</span>
        <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">pair</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Must contain at least one instance&#39;</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">pair</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Must contain at most two instances&#39;</span>
        <span class="n">value</span> <span class="o">=</span> <span class="p">[</span><span class="n">validate_instances</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">pair</span><span class="p">)</span> <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">value</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_validator_ctx</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="s1">&#39;elements&#39;</span><span class="p">):</span>
            <span class="c1"># PnR stage VerilogJsonModule</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_validator_ctx</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># skips the check while reading user constraints</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="n">group_block_instances</span> <span class="o">=</span> <span class="p">[</span><span class="n">const</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">const</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_validator_ctx</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">const</span><span class="p">,</span> <span class="n">GroupBlocks</span><span class="p">)]</span>
        <span class="k">for</span> <span class="n">pair</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
            <span class="c1"># logger.debug(f&quot;pairs {self.pairs} {self.parent.parent.get_element(pair[0])}&quot;)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">([</span><span class="n">ele</span> <span class="k">for</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">pair</span> <span class="k">if</span> <span class="n">ele</span> <span class="ow">in</span> <span class="n">group_block_instances</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Skip check for group block elements as they are added later in the flow</span>
                <span class="k">continue</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">pair</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">assert</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_validator_ctx</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">get_element</span><span class="p">(</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="sa">f</span><span class="s2">&quot;element </span><span class="si">{</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> not found in design&quot;</span>
                <span class="k">assert</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_validator_ctx</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">get_element</span><span class="p">(</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="sa">f</span><span class="s2">&quot;element </span><span class="si">{</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2"> not found in design&quot;</span>
                <span class="k">assert</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_validator_ctx</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">get_element</span><span class="p">(</span><span class="n">pair</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">parameters</span> <span class="o">==</span> \
                    <span class="bp">cls</span><span class="o">.</span><span class="n">_validator_ctx</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">get_element</span><span class="p">(</span><span class="n">pair</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">parameters</span><span class="p">,</span> \
                    <span class="sa">f</span><span class="s2">&quot;Parameters of the symmetry pair </span><span class="si">{</span><span class="n">pair</span><span class="si">}</span><span class="s2"> do not match in subckt </span><span class="si">{</span><span class="bp">cls</span><span class="o">.</span><span class="n">_validator_ctx</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="k">return</span> <span class="n">value</span></div>

<div class="viewcode-block" id="SymmetricBlocks.translate"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.SymmetricBlocks.translate">[docs]</a>    <span class="k">def</span> <span class="nf">translate</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">solver</span><span class="p">):</span>

        <span class="k">def</span> <span class="nf">construct_expression</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;x&#39;</span> <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;V&#39;</span> <span class="k">else</span> <span class="s1">&#39;y&#39;</span>
            <span class="n">expression</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;ll</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;ur</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">b2</span><span class="p">:</span>
                <span class="n">expression</span> <span class="o">+=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">b2</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;ll</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">b2</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;ur</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">expression</span> <span class="o">+=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;ll</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;ur</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">expression</span>

        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">instances</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">pairs</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">instances</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">b0</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">bbox_vars</span><span class="p">(</span><span class="n">instances</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">b1</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">bbox_vars</span><span class="p">(</span><span class="n">instances</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

                <span class="c1"># the difference between the center lines should be &lt;= 1/4th of the block heights</span>
                <span class="c1"># abs(cl_1 - cl_2) &lt;= height_1/4  &amp;&amp; abs(cl_1 - cl_2) &lt;= height_2/4</span>
                <span class="c1"># abs(4.cl_1 - 4.cl_2) &lt;= height_1, height_2</span>
                <span class="n">c</span> <span class="o">=</span> <span class="s1">&#39;y&#39;</span> <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;V&#39;</span> <span class="k">else</span> <span class="s1">&#39;x&#39;</span>
                <span class="n">b0_quad_cl</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">b0</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;ll</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">b0</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;ur</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">))</span>
                <span class="n">b1_quad_cl</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;ll</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;ur</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">))</span>
                <span class="n">expression</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">And</span><span class="p">(</span>
                    <span class="n">solver</span><span class="o">.</span><span class="n">Abs</span><span class="p">(</span><span class="n">b0_quad_cl</span> <span class="o">-</span> <span class="n">b1_quad_cl</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">b0</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;ur</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">b0</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;ll</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">),</span>
                    <span class="n">solver</span><span class="o">.</span><span class="n">Abs</span><span class="p">(</span><span class="n">b0_quad_cl</span> <span class="o">-</span> <span class="n">b1_quad_cl</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;ur</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;ll</span><span class="si">{</span><span class="n">c</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="k">yield</span> <span class="n">expression</span>

            <span class="c1"># center lines of pairs should match along the direction</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">reference</span> <span class="o">=</span> <span class="n">construct_expression</span><span class="p">(</span><span class="o">*</span><span class="n">solver</span><span class="o">.</span><span class="n">iter_bbox_vars</span><span class="p">(</span><span class="n">instances</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">centerline</span> <span class="o">=</span> <span class="n">construct_expression</span><span class="p">(</span><span class="o">*</span><span class="n">solver</span><span class="o">.</span><span class="n">iter_bbox_vars</span><span class="p">(</span><span class="n">instances</span><span class="p">))</span>
                <span class="n">expression</span> <span class="o">=</span> <span class="p">(</span><span class="n">reference</span> <span class="o">==</span> <span class="n">centerline</span><span class="p">)</span>
                <span class="k">yield</span> <span class="n">expression</span></div></div>


<div class="viewcode-block" id="OffsetsScalings"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.OffsetsScalings">[docs]</a><span class="k">class</span> <span class="nc">OffsetsScalings</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">offsets</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">scalings</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Literal</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span></div>


<div class="viewcode-block" id="PlaceOnGrid"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.PlaceOnGrid">[docs]</a><span class="k">class</span> <span class="nc">PlaceOnGrid</span><span class="p">(</span><span class="n">SoftConstraint</span><span class="p">):</span>
    <span class="n">direction</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">]</span>
    <span class="n">pitch</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">ored_terms</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">OffsetsScalings</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="p">[</span><span class="n">OffsetsScalings</span><span class="p">()])</span>

<div class="viewcode-block" id="PlaceOnGrid.ored_terms_validator"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.PlaceOnGrid.ored_terms_validator">[docs]</a>    <span class="nd">@types</span><span class="o">.</span><span class="n">validator</span><span class="p">(</span><span class="s1">&#39;ored_terms&#39;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">ored_terms_validator</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="n">pitch</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s1">&#39;pitch&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">offset</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">term</span><span class="p">,</span> <span class="s1">&#39;offsets&#39;</span><span class="p">):</span>
                <span class="k">assert</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">offset</span> <span class="o">&lt;</span> <span class="n">pitch</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;offset </span><span class="si">{</span><span class="n">offset</span><span class="si">}</span><span class="s1"> should be less than pitch </span><span class="si">{</span><span class="n">pitch</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">value</span></div></div>


<div class="viewcode-block" id="BlockDistance"><a class="viewcode-back" href="../../../notes/const.html#align.schema.constraint.BlockDistance">[docs]</a><span class="k">class</span> <span class="nc">BlockDistance</span><span class="p">(</span><span class="n">SoftConstraint</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    TODO: Replace with Spread</span>

<span class="sd">    Places the instances with a fixed gap.</span>
<span class="sd">    Also used in situations when routing is congested.</span>

<span class="sd">    Args:</span>
<span class="sd">        abs_distance (int) : Distance between two blocks.</span>
<span class="sd">            The number should be multiple of pitch of</span>
<span class="sd">            lowest horizontal and vertical routing layer i.e., M2 and M1</span>

<span class="sd">    .. image:: ../images/HorizontalDistance.PNG</span>
<span class="sd">        :align: center</span>

<span class="sd">    Example: ::</span>

<span class="sd">        {</span>
<span class="sd">            &quot;constraint&quot; : &quot;BlockDistance&quot;,</span>
<span class="sd">            &quot;abs_distance&quot; : 420</span>
<span class="sd">        }</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">abs_distance</span><span class="p">:</span> <span class="nb">int</span></div>


<div class="viewcode-block" id="VerticalDistance"><a class="viewcode-back" href="../../../notes/const.html#align.schema.constraint.VerticalDistance">[docs]</a><span class="k">class</span> <span class="nc">VerticalDistance</span><span class="p">(</span><span class="n">SoftConstraint</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    TODO: Replace with Spread</span>

<span class="sd">    Places the instances with a fixed vertical gap.</span>
<span class="sd">    Also used in situations when routing is congested.</span>

<span class="sd">    Args:</span>
<span class="sd">        abs_distance (int) : Distance between two blocks.</span>
<span class="sd">            The number should be multiple of pitch of</span>
<span class="sd">            lowest horizontal routing layer i.e., M2</span>

<span class="sd">    .. image:: ../images/VerticalDistance.PNG</span>
<span class="sd">        :align: center</span>

<span class="sd">    Example: ::</span>

<span class="sd">        {</span>
<span class="sd">            &quot;constraint&quot; : &quot;VerticalDistance&quot;,</span>
<span class="sd">            &quot;abs_distance&quot; : 84</span>
<span class="sd">        }</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">abs_distance</span><span class="p">:</span> <span class="nb">int</span></div>


<div class="viewcode-block" id="HorizontalDistance"><a class="viewcode-back" href="../../../notes/const.html#align.schema.constraint.HorizontalDistance">[docs]</a><span class="k">class</span> <span class="nc">HorizontalDistance</span><span class="p">(</span><span class="n">SoftConstraint</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    TODO: Replace with Spread</span>

<span class="sd">    Places the instances with a fixed horizontal gap.</span>
<span class="sd">    Also used in situations when routing is congested.</span>

<span class="sd">    Args:</span>
<span class="sd">        abs_distance (int) : Distance between two blocks.</span>
<span class="sd">            The number should be multiple of pitch of</span>
<span class="sd">            lowest vertical routing layer i.e., M1</span>

<span class="sd">    .. image:: ../images/HorizontalDistance.PNG</span>
<span class="sd">        :align: center</span>

<span class="sd">    Example: ::</span>

<span class="sd">        {</span>
<span class="sd">            &quot;constraint&quot; : &quot;HorizontalDistance&quot;,</span>
<span class="sd">            &quot;abs_distance&quot; : 80</span>
<span class="sd">        }</span>

<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">abs_distance</span><span class="p">:</span> <span class="nb">int</span></div>


<div class="viewcode-block" id="GuardRing"><a class="viewcode-back" href="../../../notes/const.html#align.schema.constraint.GuardRing">[docs]</a><span class="k">class</span> <span class="nc">GuardRing</span><span class="p">(</span><span class="n">SoftConstraint</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Adds guard ring for particular hierarchy.</span>

<span class="sd">    Args:</span>
<span class="sd">        guard_ring_primitives (str) : Places this instance across boundary of a hierarchy</span>
<span class="sd">        global_pin (str): connect the pin of guard ring to this pin, mostly ground pin</span>
<span class="sd">        block_name: Name of the hierarchy</span>

<span class="sd">    Example: ::</span>

<span class="sd">        {</span>
<span class="sd">            &quot;constraint&quot; : &quot;GuardRing&quot;,</span>
<span class="sd">            &quot;guard_ring_primitives&quot; : &quot;guard_ring&quot;,</span>
<span class="sd">            &quot;global_pin</span>
<span class="sd">        }</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">guard_ring_primitives</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">global_pin</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">block_name</span><span class="p">:</span> <span class="nb">str</span></div>


<div class="viewcode-block" id="GroupCaps"><a class="viewcode-back" href="../../../notes/const.html#align.schema.constraint.GroupCaps">[docs]</a><span class="k">class</span> <span class="nc">GroupCaps</span><span class="p">(</span><span class="n">SoftConstraint</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;GroupCaps</span>
<span class="sd">    Creates a common centroid cap using a combination</span>
<span class="sd">    of unit sized caps. It can be of multiple caps.</span>

<span class="sd">    Args:</span>
<span class="sd">        name (str): name for grouped caps</span>
<span class="sd">        instances (List[str]): list of cap :obj:`instances`</span>
<span class="sd">        unit_cap (str): Capacitance value in fF</span>
<span class="sd">        num_units (List[int]): Number of units for each capacitance instance</span>
<span class="sd">        dummy (bool):  Whether to fill in dummies or not</span>

<span class="sd">   Example: ::</span>

<span class="sd">        {</span>
<span class="sd">            &quot;constraint&quot; : &quot;GroupCaps&quot;,</span>
<span class="sd">            &quot;name&quot; : &quot;cap_group1&quot;,</span>
<span class="sd">            &quot;instances&quot; : [&quot;C0&quot;, &quot;C1&quot;, &quot;C2&quot;],</span>
<span class="sd">            &quot;num_units&quot; : [2, 4, 8],</span>
<span class="sd">            &quot;dummy&quot; : true</span>
<span class="sd">        }</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># subcircuit name</span>
    <span class="n">instances</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">unit_cap</span><span class="p">:</span> <span class="nb">str</span>  <span class="c1"># cap value in fF</span>
    <span class="n">num_units</span><span class="p">:</span> <span class="n">List</span>
    <span class="n">dummy</span><span class="p">:</span> <span class="nb">bool</span>  <span class="c1"># whether to fill in dummies</span></div>


<div class="viewcode-block" id="NetPriority"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.NetPriority">[docs]</a><span class="k">class</span> <span class="nc">NetPriority</span><span class="p">(</span><span class="n">SoftConstraint</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Specify a non-negative priority for a list of nets for placement (default = 1).</span>
<span class="sd">    Example: {&quot;constraint&quot;: &quot;NetPriority&quot;, &quot;nets&quot;: [&quot;en&quot;, &quot;enb&quot;], &quot;priority&quot;: 0}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nets</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">weight</span><span class="p">:</span> <span class="nb">int</span>

    <span class="n">_weight</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">validator</span><span class="p">(</span><span class="s1">&#39;weight&#39;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">assert_non_negative</span><span class="p">)</span>
    <span class="n">_upper_case</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">validator</span><span class="p">(</span><span class="s1">&#39;nets&#39;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">upper_case</span><span class="p">)</span></div>


<div class="viewcode-block" id="NetConst"><a class="viewcode-back" href="../../../notes/const.html#align.schema.constraint.NetConst">[docs]</a><span class="k">class</span> <span class="nc">NetConst</span><span class="p">(</span><span class="n">SoftConstraint</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;NetConst</span>

<span class="sd">    Net based constraint. Shielding and critically can be defined.</span>

<span class="sd">    Args:</span>
<span class="sd">        nets (List[str]) : List of net names.</span>
<span class="sd">        shield (str, optional) : Name of net for shielding.</span>
<span class="sd">        criticality (int, optional) : Criticality of net.</span>
<span class="sd">            Higher criticality means the net would be routed first.</span>

<span class="sd">    Example: ::</span>

<span class="sd">        {</span>
<span class="sd">            &quot;constraint&quot; : &quot;NetConst&quot;,</span>
<span class="sd">            &quot;nets&quot; : [&quot;net1&quot;, &quot;net2&quot;, &quot;net3&quot;],</span>
<span class="sd">            &quot;shield&quot; : &quot;VSS&quot;,</span>
<span class="sd">            &quot;criticality&quot; : 10</span>
<span class="sd">        }</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nets</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">shield</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">criticality</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span></div>


<div class="viewcode-block" id="PortLocation"><a class="viewcode-back" href="../../../notes/const.html#align.schema.constraint.PortLocation">[docs]</a><span class="k">class</span> <span class="nc">PortLocation</span><span class="p">(</span><span class="n">SoftConstraint</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;PortLocation</span>
<span class="sd">    Defines approximate location of the port.</span>
<span class="sd">    T (top), L (left), C (center), R (right), B (bottom)</span>

<span class="sd">    Args:</span>
<span class="sd">        ports (List[str]) : List of ports</span>
<span class="sd">        location (str): Literal::</span>

<span class="sd">            [&#39;TL&#39;, &#39;TC&#39;, &#39;TR&#39;,</span>
<span class="sd">            &#39;RT&#39;, &#39;RC&#39;, &#39;RB&#39;,</span>
<span class="sd">            &#39;BL&#39;, &#39;BC&#39;, &#39;BR&#39;,</span>
<span class="sd">            &#39;LB&#39;, &#39;LC&#39;, &#39;LT&#39;]</span>

<span class="sd">    Example ::</span>

<span class="sd">        {</span>
<span class="sd">            &quot;constraint&quot; : &quot;PortLocation&quot;,</span>
<span class="sd">            &quot;ports&quot; : [&quot;P0&quot;, &quot;P1&quot;, &quot;P2&quot;],</span>
<span class="sd">            &quot;location&quot; : &quot;TL&quot;</span>
<span class="sd">        }</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">ports</span><span class="p">:</span> <span class="n">List</span>
    <span class="n">location</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;TL&#39;</span><span class="p">,</span> <span class="s1">&#39;TC&#39;</span><span class="p">,</span> <span class="s1">&#39;TR&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;RT&#39;</span><span class="p">,</span> <span class="s1">&#39;RC&#39;</span><span class="p">,</span> <span class="s1">&#39;RB&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;BL&#39;</span><span class="p">,</span> <span class="s1">&#39;BC&#39;</span><span class="p">,</span> <span class="s1">&#39;BR&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;LB&#39;</span><span class="p">,</span> <span class="s1">&#39;LC&#39;</span><span class="p">,</span> <span class="s1">&#39;LT&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="SymmetricNets"><a class="viewcode-back" href="../../../notes/const.html#align.schema.constraint.SymmetricNets">[docs]</a><span class="k">class</span> <span class="nc">SymmetricNets</span><span class="p">(</span><span class="n">SoftConstraint</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;SymmetricNets</span>
<span class="sd">    Defines two nets as symmetric.</span>
<span class="sd">    A symmetric net will also enforce a SymmetricBlock between blocks</span>
<span class="sd">    connected to the nets.</span>

<span class="sd">    Args:</span>
<span class="sd">        net1 (str) : Name on net1</span>
<span class="sd">        net2 (str) : Name of net2</span>
<span class="sd">        pins1 (List, Optional) : oredered list of connected pins to be matched</span>
<span class="sd">        pins2 (List, Optional) : oredered list of connected pins to be matched</span>
<span class="sd">        direction (str) : Literal [&#39;H&#39;, &#39;V&#39;], Horizontal or vertical line of symmetry</span>

<span class="sd">    Example ::</span>

<span class="sd">        {</span>
<span class="sd">            &quot;constraint&quot; : &quot;SymmetricNets&quot;,</span>
<span class="sd">            &quot;net1&quot; : &quot;net1&quot;</span>
<span class="sd">            &quot;net2&quot; : &quot;net2&quot;</span>
<span class="sd">            &quot;pins1&quot; : [&quot;block1/A&quot;, &quot;block2/A&quot;, &quot;port1&quot;]</span>
<span class="sd">            &quot;pins2&quot; : [&quot;block1/B&quot;, &quot;block2/B&quot;, &quot;port2&quot;]</span>
<span class="sd">            &quot;direction&quot; : &#39;V&#39;</span>
<span class="sd">        }</span>
<span class="sd">     &#39;&#39;&#39;</span>

    <span class="n">net1</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">net2</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">pins1</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span>
    <span class="n">pins2</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">]</span>
    <span class="n">direction</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="s1">&#39;V&#39;</span><span class="p">]</span></div>


<div class="viewcode-block" id="MultiConnection"><a class="viewcode-back" href="../../../notes/const.html#align.schema.constraint.MultiConnection">[docs]</a><span class="k">class</span> <span class="nc">MultiConnection</span><span class="p">(</span><span class="n">SoftConstraint</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;MultiConnection</span>
<span class="sd">    Defines multiple parallel wires for a net.</span>
<span class="sd">    This constraint is used to reduce parasitics and</span>
<span class="sd">    Electro-migration (EM) violations</span>

<span class="sd">    Args:</span>
<span class="sd">        nets (List[str]) : List of nets</span>
<span class="sd">        multiplier (int): Number of parallel wires</span>

<span class="sd">    Example ::</span>

<span class="sd">        {</span>
<span class="sd">            &quot;constraint&quot; : &quot;MultiConnection&quot;,</span>
<span class="sd">            &quot;nets&quot; : [&quot;N1&quot;, &quot;N2&quot;, &quot;N3&quot;],</span>
<span class="sd">            &quot;multiplier&quot; : 4</span>
<span class="sd">        }</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">nets</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">multiplier</span><span class="p">:</span> <span class="nb">int</span></div>


<div class="viewcode-block" id="DoNotRoute"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.DoNotRoute">[docs]</a><span class="k">class</span> <span class="nc">DoNotRoute</span><span class="p">(</span><span class="n">SoftConstraint</span><span class="p">):</span>
    <span class="n">nets</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>

    <span class="n">_upper_case</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">validator</span><span class="p">(</span><span class="s1">&#39;nets&#39;</span><span class="p">,</span> <span class="n">allow_reuse</span><span class="o">=</span><span class="kc">True</span><span class="p">)(</span><span class="n">upper_case</span><span class="p">)</span></div>


<span class="n">ConstraintType</span> <span class="o">=</span> <span class="n">Union</span><span class="p">[</span>
    <span class="c1"># ALIGN Internal DSL</span>
    <span class="n">Order</span><span class="p">,</span> <span class="n">Align</span><span class="p">,</span> <span class="n">Floorplan</span><span class="p">,</span>
    <span class="n">Enclose</span><span class="p">,</span> <span class="n">Spread</span><span class="p">,</span>
    <span class="n">AssignBboxVariables</span><span class="p">,</span>
    <span class="n">AspectRatio</span><span class="p">,</span>
    <span class="n">Boundary</span><span class="p">,</span>
    <span class="c1"># Additional User constraints</span>
    <span class="n">AlignInOrder</span><span class="p">,</span>
    <span class="c1"># Legacy Align constraints</span>
    <span class="c1"># (SoftConstraints)</span>
    <span class="n">CompactPlacement</span><span class="p">,</span>
    <span class="n">Generator</span><span class="p">,</span>
    <span class="n">SameTemplate</span><span class="p">,</span>
    <span class="n">CreateAlias</span><span class="p">,</span>
    <span class="n">GroupBlocks</span><span class="p">,</span>
    <span class="n">PlaceCloser</span><span class="p">,</span>
    <span class="n">DoNotIdentify</span><span class="p">,</span>
    <span class="n">PlaceOnGrid</span><span class="p">,</span>
    <span class="n">BlockDistance</span><span class="p">,</span>
    <span class="n">HorizontalDistance</span><span class="p">,</span>
    <span class="n">VerticalDistance</span><span class="p">,</span>
    <span class="n">GuardRing</span><span class="p">,</span>
    <span class="n">SymmetricBlocks</span><span class="p">,</span>
    <span class="n">GroupCaps</span><span class="p">,</span>
    <span class="n">NetConst</span><span class="p">,</span>
    <span class="n">PortLocation</span><span class="p">,</span>
    <span class="n">SymmetricNets</span><span class="p">,</span>
    <span class="n">MultiConnection</span><span class="p">,</span>
    <span class="n">DoNotRoute</span><span class="p">,</span>
    <span class="c1"># Setup constraints</span>
    <span class="n">PowerPorts</span><span class="p">,</span>
    <span class="n">GroundPorts</span><span class="p">,</span>
    <span class="n">ClockPorts</span><span class="p">,</span>
    <span class="n">DoNotUseLib</span><span class="p">,</span>
    <span class="n">ConfigureCompiler</span><span class="p">,</span>
    <span class="n">NetPriority</span>
<span class="p">]</span>


<div class="viewcode-block" id="ConstraintDB"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.ConstraintDB">[docs]</a><span class="k">class</span> <span class="nc">ConstraintDB</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">List</span><span class="p">[</span><span class="n">ConstraintType</span><span class="p">]):</span>

<div class="viewcode-block" id="ConstraintDB.append"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.ConstraintDB.append">[docs]</a>    <span class="nd">@types</span><span class="o">.</span><span class="n">validate_arguments</span>
    <span class="k">def</span> <span class="nf">append</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constraint</span><span class="p">:</span> <span class="n">ConstraintType</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">constraint_str</span> <span class="o">:=</span> <span class="nb">repr</span><span class="p">(</span><span class="n">constraint</span><span class="p">))</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">constraint</span><span class="p">,</span> <span class="s1">&#39;translate&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">_checker</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">verify</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">verify</span><span class="p">(</span><span class="n">constraint</span><span class="o">=</span><span class="n">constraint</span><span class="p">)</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">constraint</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cache</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">constraint_str</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Constraint is duplicated: </span><span class="si">{</span><span class="n">constraint_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ConstraintDB.remove"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.ConstraintDB.remove">[docs]</a>    <span class="nd">@types</span><span class="o">.</span><span class="n">validate_arguments</span>
    <span class="k">def</span> <span class="nf">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constraint</span><span class="p">:</span> <span class="n">ConstraintType</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">constraint</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="c1"># Constraints may need to access parent scope for subcircuit information</span>
        <span class="c1"># To ensure parent is set appropriately, force users to use append</span>
        <span class="k">if</span> <span class="s1">&#39;__root__&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;__root__&#39;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;__root__&#39;</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">args</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># TODO: Shouldn&#39;t need to invalidate this</span>
        <span class="c1">#       Lots of thrash happening here</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">_checker</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">with</span> <span class="n">set_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<div class="viewcode-block" id="ConstraintDB.checkpoint"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.ConstraintDB.checkpoint">[docs]</a>    <span class="k">def</span> <span class="nf">checkpoint</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">_checker</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">verify</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">_checker</span><span class="o">.</span><span class="n">checkpoint</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">checkpoint</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_revert</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">_checker</span><span class="o">.</span><span class="n">revert</span><span class="p">()</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">_revert</span><span class="p">()</span></div>


<div class="viewcode-block" id="expand_user_constraints"><a class="viewcode-back" href="../../../modules/align.schema.html#align.schema.constraint.expand_user_constraints">[docs]</a><span class="k">def</span> <span class="nf">expand_user_constraints</span><span class="p">(</span><span class="n">const_list</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">const</span> <span class="ow">in</span> <span class="n">const_list</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">const</span><span class="p">,</span> <span class="s1">&#39;yield_constraints&#39;</span><span class="p">):</span>
            <span class="k">with</span> <span class="n">types</span><span class="o">.</span><span class="n">set_context</span><span class="p">(</span><span class="n">const</span><span class="o">.</span><span class="n">parent</span><span class="p">):</span>
                <span class="k">yield from</span> <span class="n">const</span><span class="o">.</span><span class="n">yield_constraints</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">const</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, ALIGN team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>